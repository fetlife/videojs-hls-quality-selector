/**
 * videojs-hls-quality-selector
 * @version 1.1.2
 * @copyright 2020 Chris Boustead (chris@forgemotion.com)
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):t.videojsHlsQualitySelector=e(t.videojs)}(this,function(o){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=(function(){function r(t){this.value=t}function t(o){var u,l;function s(t,e){try{var i=o[t](e),n=i.value;n instanceof r?Promise.resolve(n.value).then(function(t){s("next",t)},function(t){s("throw",t)}):a(i.done?"return":"normal",i.value)}catch(t){a("throw",t)}}function a(t,e){switch(t){case"return":u.resolve({value:e,done:!0});break;case"throw":u.reject(e);break;default:u.resolve({value:e,done:!1})}(u=u.next)?s(u.key,u.arg):l=null}this._invoke=function(n,o){return new Promise(function(t,e){var i={key:n,arg:o,resolve:t,reject:e,next:null};l?l=l.next=i:(u=l=i,s(n,o))})},"function"!=typeof o.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(t){return this._invoke("next",t)},t.prototype.throw=function(t){return this._invoke("throw",t)},t.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),t=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},e=o.getComponent("MenuButton"),u=o.getComponent("Menu"),l=o.getComponent("Component"),h=o.dom;var c=function(e){function i(t){return a(this,i),r(this,e.call(this,t,{title:t.localize("Quality"),name:"QualityButton"}))}return t(i,e),i.prototype.createItems=function(){return[]},i.prototype.createMenu=function(){var t,e=new u(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title){var i=h.createEl("li",{className:"vjs-menu-title",innerHTML:(t=this.options_.title,"string"!=typeof t?t:t.charAt(0).toUpperCase()+t.slice(1)),tabIndex:-1}),n=new l(this.player_,{el:i});this.hideThreshold_+=1,e.addItem(n)}if(this.items=this.createItems(),this.items)for(var o=0;o<this.items.length;o++)e.addItem(this.items[o]);return e},i}(e),n=function(u){function l(t,e,i,n){a(this,l);var o=r(this,u.call(this,t,{label:e.label,selectable:!0,selected:e.selected||!1}));return o.item=e,o.qualityButton=i,o.plugin=n,o}return t(l,u),l.prototype.handleClick=function(){for(var t=0;t<this.qualityButton.items.length;++t)this.qualityButton.items[t].selected(!1);this.selected(!0),this.plugin.setQuality(this.item.value)},l}(o.getComponent("MenuItem")),y={},i=o.registerPlugin||o.plugin,d=function(){function i(t,e){a(this,i),this.player=t,this.config=e,this.labelQualityLevel=this.config.labelQualityLevel||this.defaultLabelQualityLevel,this.isQualityHd=this.config.isQualityHd||this.defaultIsQualityHd,this.isQualityFourK=this.config.isQualityFourK||this.defaultIsQualityFourK,this.isQualityEnabled=this.config.isQualityEnabled||this.defaultIsQualityEnabled,this.player.qualityLevels&&this.getHls()&&(this.createQualityButton(),this.updateQualityLevels(),this.bindPlayerEvents(),this.updateUi())}return i.prototype.defaultLabelQualityLevel=function(t,e){return e+"p"},i.prototype.defaultIsQualityHd=function(t,e){return 720<=e},i.prototype.defaultIsQualityFourK=function(t,e){return 2160===e},i.prototype.defaultIsQualityEnabled=function(t,e){return!0},i.prototype.getHls=function(){return this.player.tech({IWillNotUseThisInPlugins:!0}).hls},i.prototype.bindPlayerEvents=function(){this.player.qualityLevels().on("addqualitylevel",this.onAddQualityLevel.bind(this));var t=this.getSegmentMetadataTrack();t&&t.on("cuechange",this.onCueChange.bind(this))},i.prototype.createQualityButton=function(){var t=this.player,e="vjs-quality-selector",i=new c(t);this._qualityButton=i;var n=t.controlBar.children().length-2,o=t.controlBar.addChild(this._qualityButton,{componentClass:"qualitySelector"},this.config.placementIndex||n);if(o.addClass(e),this.config.displayCurrentQuality)this.setButtonInnerText("auto");else{var u=" "+(this.config.vjsIconClass||"vjs-icon-hd");o.menuButton_.$(".vjs-icon-placeholder").className+=u}o.removeClass("vjs-hidden"),document.addEventListener("click",function(t){t.target.closest("."+e)||i.unpressButton()})},i.prototype.setButtonInnerText=function(t){this._qualityButton.menuButton_.$(".vjs-icon-placeholder").innerHTML=t},i.prototype.getQualityMenuItem=function(t){var e=this.player;return new n(e,t,this._qualityButton,this)},i.prototype.onAddQualityLevel=function(t){var e=t.qualityLevel;e.enabled=this.isQualityEnabled(e.width,e.height),this.updateQualityLevels()},i.prototype.levelExists=function(t,e){return t.filter(function(t){return t.item&&t.item.value===e.height}).length},i.prototype.updateQualityLevels=function(){for(var i=this,t=this.player.qualityLevels().levels_||[],e=[],n=0;n<t.length;++n){var o=t[n].width,u=t[n].height;if(this.isQualityEnabled(o,u)&&!this.levelExists(e,t[n])){var l=this.getQualityMenuItem.call(this,{label:this.labelQualityLevel(o,u),value:t[n].height});this.config.fourKIconClass&&this.isQualityFourK(o,u)?l.addClass(this.config.fourKIconClass):this.config.hdIconClass&&this.isQualityHd(o,u)&&l.addClass(this.config.hdIconClass),e.push(l)}}e.sort(function(t,e){return"object"!==(void 0===t?"undefined":s(t))||"object"!==(void 0===e?"undefined":s(e))?-1:t.item.value<e.item.value?i.config.invertQualityOrder?1:-1:t.item.value>e.item.value?i.config.invertQualityOrder?-1:1:0}),this._autoMenuItem=this.getQualityMenuItem.call(this,{label:"Auto (test)",value:"auto",selected:!0}),this.updateAutoLabel(),e.push(this._autoMenuItem),this._qualityButton&&(this._qualityButton.createItems=function(){return e},this._qualityButton.update())},i.prototype.getSegmentMetadataTrack=function(){for(var t=this.player.textTracks(),e=0;e<t.length;e++)if("segment-metadata"===t[e].label)return t[e];return null},i.prototype.getCurrentResolution=function(){var t=this.getSegmentMetadataTrack();if(!t)return null;var e=t.activeCues[0];return e?e.value.resolution:null},i.prototype.updateAutoLabel=function(){if(this._autoMenuItem){var t=this.getCurrentResolution(),e=this.player.localize("Auto");if(t&&this._autoMenuItem.isSelected_){var i=this.labelQualityLevel(t.width,t.height);this._autoMenuItem.el().innerText=e+" ("+i+")"}else this._autoMenuItem.el().innerText=e}},i.prototype.showQualityButtonFourKIcon=function(){this._qualityButton.addClass(this.config.fourKIconClass)},i.prototype.hideQualityButtonFourKIcon=function(){this._qualityButton.removeClass(this.config.fourKIconClass)},i.prototype.showQualityButtonHdIcon=function(){this._qualityButton.addClass(this.config.hdIconClass)},i.prototype.hideQualityButtonHdIcon=function(){this._qualityButton.removeClass(this.config.hdIconClass)},i.prototype.updateQualityButtonIcon=function(){var t=this.getCurrentResolution();t&&(this.isQualityFourK(t.width,t.height)?(this.hideQualityButtonHdIcon(),this.showQualityButtonFourKIcon()):(this.isQualityHd(t.width,t.height)?this.showQualityButtonHdIcon():this.hideQualityButtonHdIcon(),this.hideQualityButtonFourKIcon()))},i.prototype.updateUi=function(){this.updateQualityButtonIcon(),this.updateAutoLabel()},i.prototype.onCueChange=function(){this.updateUi()},i.prototype.setQuality=function(t){var e=this.player.qualityLevels();this.config.displayCurrentQuality&&this.setButtonInnerText("auto"===t?t:t+"p");for(var i=void 0,n=0;n<e.length;++n){var o=e[n];o.height===t?(o.enabled=!0,i=n):o.enabled="auto"===t&&this.isQualityEnabled(o.width,o.height)}i?(e.selectedIndex_=i,e.trigger({type:"change",selectedIndex:i})):e.trigger({type:"change"}),this.updateUi(),this._qualityButton.unpressButton()},i}(),f=function(i){var n=this;this.ready(function(){var t,e;t=n,e=o.mergeOptions(y,i),t.addClass("vjs-hls-quality-selector"),t.hlsQualitySelector=new d(t,e)})};return i("hlsQualitySelector",f),f.VERSION="1.1.2",f});